"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_utils=require("../../ui/src/utils"),_dom=require("../../ui/src/dom"),_util=require("./util"),_vn=require("../../ui/src/vn"),_buttonGroup=_interopRequireDefault(require("../../button/src/button-group"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default=(0,_vue.defineComponent)({name:"VxeDatePicker",props:{modelValue:[String,Number,Date],immediate:{type:Boolean,default:!0},name:String,type:{type:String,default:"date"},clearable:{type:Boolean,default:()=>(0,_ui.getConfig)().datePicker.clearable},readonly:{type:Boolean,default:null},disabled:{type:Boolean,default:null},placeholder:String,maxLength:[String,Number],autoComplete:{type:String,default:"off"},align:String,form:String,className:String,size:{type:String,default:()=>(0,_ui.getConfig)().datePicker.size||(0,_ui.getConfig)().size},multiple:Boolean,limitCount:{type:[String,Number],default:()=>(0,_ui.getConfig)().upload.limitCount},startDate:{type:[String,Number,Date],default:()=>(0,_ui.getConfig)().datePicker.startDate},endDate:{type:[String,Number,Date],default:()=>(0,_ui.getConfig)().datePicker.endDate},minDate:[String,Number,Date],maxDate:[String,Number,Date],startDay:{type:[String,Number],default:()=>(0,_ui.getConfig)().datePicker.startDay},labelFormat:String,valueFormat:String,editable:{type:Boolean,default:!0},festivalMethod:{type:Function,default:()=>(0,_ui.getConfig)().datePicker.festivalMethod},disabledMethod:{type:Function,default:()=>(0,_ui.getConfig)().datePicker.disabledMethod},selectDay:{type:[String,Number],default:()=>(0,_ui.getConfig)().datePicker.selectDay},prefixIcon:String,suffixIcon:String,placement:String,transfer:{type:Boolean,default:null},shortcutConfig:Object,startWeek:Number,maxlength:[String,Number],autocomplete:String},emits:["update:modelValue","input","change","keydown","keyup","click","focus","blur","clear","prefix-click","suffix-click","date-prev","date-today","date-next","shortcut-click"],setup(I,u){const{slots:k,emit:h}=u,g=(0,_vue.inject)("$xeModal",null),T=(0,_vue.inject)("$xeDrawer",null),W=(0,_vue.inject)("$xeTable",null),a=(0,_vue.inject)("$xeForm",null),l=(0,_vue.inject)("xeFormItemInfo",null);var e=_xeUtils.default.uniqueId();const N=(0,_ui.useSize)(I)["computeSize"],K=(0,_vue.reactive)({initialized:!1,panelIndex:0,visiblePanel:!1,isAniVisible:!1,panelStyle:{},panelPlacement:"",isActivated:!1,inputValue:"",datetimePanelValue:null,datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}),c={yearSize:12,monthSize:20,quarterSize:8,hpTimeout:void 0},b=(0,_vue.ref)(),U=(0,_vue.ref)(),M=(0,_vue.ref)(),r=(0,_vue.ref)(),C=(0,_vue.ref)(),A={refElem:b,refInput:U},s={xID:e,props:I,context:u,reactData:K,internalData:c,getRefMaps:()=>A};const Y=(0,_vue.computed)(()=>{var e=I["transfer"];if(null===e){var t=(0,_ui.getConfig)().datePicker.transfer;if(_xeUtils.default.isBoolean(t))return t;if(W||g||T||a)return!0}return e}),D=(0,_vue.computed)(()=>{var e=I["readonly"];return null===e?!!a&&a.props.readonly:e}),P=(0,_vue.computed)(()=>{var e=I["disabled"];return null===e?!!a&&a.props.disabled:e}),o=(0,_vue.computed)(()=>{var e=I["type"];return"time"===e||"datetime"===e}),x=(0,_vue.computed)(()=>{return o.value||-1<["date","week","month","quarter","year"].indexOf(I.type)}),L=(0,_vue.computed)(()=>I.clearable),q=(0,_vue.computed)(()=>I.startDate?_xeUtils.default.toStringDate(I.startDate):null),O=(0,_vue.computed)(()=>I.endDate?_xeUtils.default.toStringDate(I.endDate):null),$=(0,_vue.computed)(()=>-1<["date","week","month","quarter","year"].indexOf(I.type)),H=(0,_vue.computed)(()=>{var{modelValue:e,multiple:t}=I,a=x.value;const l=p.value;return t&&e&&a?_xeUtils.default.toValueString(e).split(",").map(e=>{e=d(e,l);return _xeUtils.default.isValidDate(e),e}):[]}),Q=(0,_vue.computed)(()=>{var e=H.value;const t=p.value;return e.map(e=>_xeUtils.default.toDateString(e,t))}),Z=(0,_vue.computed)(()=>{var e=H.value;const t=n.value;return e.map(e=>_xeUtils.default.toDateString(e,t)).join(", ")}),J=(0,_vue.computed)(()=>I.multiple?_xeUtils.default.toNumber(I.limitCount):0),F=(0,_vue.computed)(()=>{var e=I["multiple"],t=J.value,a=Q.value;return!(!e||!t)&&a.length>=t}),p=(0,_vue.computed)(()=>{var{type:e,valueFormat:t}=I;return t||("time"===e?"HH:mm:ss":"datetime"===e?"yyyy-MM-dd HH:mm:ss":"yyyy-MM-dd")}),B=(0,_vue.computed)(()=>{var e=I["modelValue"],t=x.value,a=p.value;let l=null;return l=e&&t&&(t=d(e,a),_xeUtils.default.isValidDate(t))?t:l}),X=(0,_vue.computed)(()=>{var e=q.value,t=K["selectMonth"];return!(!t||!e)&&t<=e}),ee=(0,_vue.computed)(()=>{var e=O.value,t=K["selectMonth"];return!(!t||!e)&&e<=t}),te=(0,_vue.computed)(()=>{var e=K["datetimePanelValue"],t=xe.value;return e?_xeUtils.default.toDateString(e,t?"HH:mm:ss":"HH:mm"):""}),ae=(0,_vue.computed)(()=>{var e=B.value,t=o.value;return e&&t?1e3*(3600*e.getHours()+60*e.getMinutes()+e.getSeconds()):0}),n=(0,_vue.computed)(()=>{var e=I["labelFormat"];return x.value?e||(0,_ui.getI18n)("vxe.input.date.labelFormat."+I.type):null}),le=(0,_vue.computed)(()=>{var t=c["yearSize"],{selectMonth:e,currentDate:a}=K,l=[];if(e&&a){var i=a.getFullYear(),a=e.getFullYear(),u=new Date(a-a%t,0,1);for(let e=-4;e<t+4;e++){var r=_xeUtils.default.getWhatYear(u,e,"first"),s=r.getFullYear();l.push({date:r,isCurrent:!0,isPrev:e<0,isNow:i===s,isNext:e>=t,year:s})}}return l}),ie=(0,_vue.computed)(()=>{let a="",l="";if(x.value){var{datePanelType:i,selectMonth:u}=K,r=le.value;let e="",t;u&&(e=u.getFullYear(),t=u.getMonth()+1),"quarter"===i||"month"===i?a=(0,_ui.getI18n)("vxe.datePicker.yearTitle",[e]):"year"===i?a=r.length?r[0].year+" - "+r[r.length-1].year:"":(a=(0,_ui.getI18n)("vxe.datePicker.yearTitle",[e]),l=t?(0,_ui.getI18n)("vxe.input.date.m"+t):"-")}return{y:a,m:l}}),y=(0,_vue.computed)(()=>{var{startDay:e,startWeek:t}=I;return _xeUtils.default.toNumber(_xeUtils.default.isNumber(e)||_xeUtils.default.isString(e)?e:t)}),ue=(0,_vue.computed)(()=>{var a=[];if(x.value){let t=y.value;a.push(t);for(let e=0;e<6;e++)6<=t?t=0:t++,a.push(t)}return a}),re=(0,_vue.computed)(()=>{return x.value?ue.value.map(e=>({value:e,label:(0,_ui.getI18n)("vxe.input.date.weeks.w"+e)})):[]}),se=(0,_vue.computed)(()=>{var e;return x.value?(e=re.value,[{label:(0,_ui.getI18n)("vxe.input.date.weeks.w")}].concat(e)):[]}),ne=(0,_vue.computed)(()=>{var e=le.value;return _xeUtils.default.chunk(e,4)}),de=(0,_vue.computed)(()=>{var t=c["quarterSize"],{selectMonth:e,currentDate:a}=K,l=[];if(e&&a){var i=a.getFullYear(),u=(0,_util.getDateQuarter)(a),r=_xeUtils.default.getWhatYear(e,0,"first"),s=r.getFullYear();for(let e=-2;e<t-2;e++){var n=_xeUtils.default.getWhatQuarter(r,e),d=n.getFullYear(),v=(0,_util.getDateQuarter)(n),o=d<s;l.push({date:n,isPrev:o,isCurrent:d===s,isNow:d===i&&v===u,isNext:!o&&s<d,quarter:v})}}return l}),ve=(0,_vue.computed)(()=>{var e=de.value;return _xeUtils.default.chunk(e,2)}),oe=(0,_vue.computed)(()=>{var t=c["monthSize"],{selectMonth:a,currentDate:e}=K,l=[];if(a&&e){var i=e.getFullYear(),u=e.getMonth(),r=_xeUtils.default.getWhatYear(a,0,"first").getFullYear();for(let e=-4;e<t-4;e++){var s=_xeUtils.default.getWhatYear(a,0,e),n=s.getFullYear(),d=s.getMonth(),v=n<r;l.push({date:s,isPrev:v,isCurrent:n===r,isNow:n===i&&d===u,isNext:!v&&r<n,month:d})}}return l}),ce=(0,_vue.computed)(()=>{var e=oe.value;return _xeUtils.default.chunk(e,4)}),pe=(0,_vue.computed)(()=>{var{selectMonth:t,currentDate:e}=K,a=[];if(t&&e){var l=ae.value,i=ue.value,u=e.getFullYear(),r=e.getMonth(),s=e.getDate(),n=t.getFullYear(),d=t.getMonth(),e=t.getDay(),i=-i.indexOf(e),v=new Date(_xeUtils.default.getWhatDay(t,i).getTime()+l);for(let e=0;e<42;e++){var o=_xeUtils.default.getWhatDay(v,e),c=o.getFullYear(),p=o.getMonth(),_=o.getDate(),f=o<t;a.push({date:o,isPrev:f,isCurrent:c===n&&p===d,isNow:c===u&&p===r&&_===s,isNext:!f&&d!==p,label:_})}}return a}),_e=(0,_vue.computed)(()=>{var e=pe.value;return _xeUtils.default.chunk(e,7)}),fe=(0,_vue.computed)(()=>{var e=_e.value;const a=y.value;return e.map(e=>{var t=e[0];return[{date:t.date,isWeekNumber:!0,isPrev:!1,isCurrent:!1,isNow:!1,isNext:!1,label:_xeUtils.default.getYearWeek(t.date,a)}].concat(e)})}),me=(0,_vue.computed)(()=>{var t=[];if(o.value)for(let e=0;e<24;e++)t.push({value:e,label:(""+e).padStart(2,"0")});return t}),he=(0,_vue.computed)(()=>{var t=[];if(o.value)for(let e=0;e<60;e++)t.push({value:e,label:(""+e).padStart(2,"0")});return t}),ge=(0,_vue.computed)(()=>{var e=p.value;return!/HH/.test(e)||/mm/.test(e)}),xe=(0,_vue.computed)(()=>{var e=p.value;return!/HH/.test(e)||/ss/.test(e)}),ye=(0,_vue.computed)(()=>{return he.value}),ke=(0,_vue.computed)(()=>{var{type:e,editable:t,multiple:a}=I;return D.value||a||!t||"week"===e||"quarter"===e}),be=(0,_vue.computed)(()=>"text"),Ue=(0,_vue.computed)(()=>{var e=I["placeholder"];return(e=e||(0,_ui.getConfig)().datePicker.placeholder)?(0,_utils.getFuncText)(e):(0,_ui.getI18n)("vxe.base.pleaseSelect")}),De=(0,_vue.computed)(()=>{var e=I["immediate"];return e}),Pe=(0,_vue.computed)(()=>Object.assign({},(0,_ui.getConfig)().datePicker.shortcutConfig,I.shortcutConfig)),Se=e=>{var{isActivated:t,visiblePanel:a}=K;let l="";e&&(l=_xeUtils.default.isNumber(e)&&/^[0-9]{11,15}$/.test(""+e)?new Date(e):e),K.inputValue=l,t&&a&&et()},d=(e,t)=>{var{type:a,multiple:l}=I;return"time"===a?(0,_util.toStringTimeDate)(e):_xeUtils.default.isArray(e)?_xeUtils.default.toStringDate(e[0],t):_xeUtils.default.isString(e)?_xeUtils.default.toStringDate(l?_xeUtils.default.last(e.split(",")):e,t):_xeUtils.default.toStringDate(e,t)},t=e=>{var t=K["inputValue"];m(e.type,{value:t},e)},_=(e,t)=>{K.inputValue=e,h("update:modelValue",e),_xeUtils.default.toValueString(I.modelValue)!==e&&(m("change",{value:e},t),a)&&l&&a.triggerItemEvent(t,l.itemConfig.field,e)},Ee=e=>{var t=x.value,a=De.value,l=e.target.value;K.inputValue=l,t||(a?_(l,e):m("input",{value:l},e))},we=e=>{De.value||t(e)},Ve=e=>{K.isActivated=!0,x.value&&w(e),t(e)},Te=e=>{var t;P.value||(t=K["inputValue"],m("prefix-click",{value:t},e))},S=()=>new Promise(e=>{K.visiblePanel=!1,c.hpTimeout=setTimeout(()=>{K.isAniVisible=!1,e()},350)}),We=(e,t)=>{x.value&&S(),_("",e),m("clear",{value:t},e)},Ne=e=>{var t;P.value||(t=K["inputValue"],m("suffix-click",{value:t},e))},i=e=>{var t=I["type"],a=n.value,l=p.value,i=y.value;let u=null,r="";e&&(u=d(e,l)),_xeUtils.default.isValidDate(u)?(r=_xeUtils.default.toDateString(u,a,{firstDay:i}),a&&"week"===t&&(e=_xeUtils.default.getYearWeek(u,i),(l=_xeUtils.default.getWhatWeek(u,0,1===e?(6+i)%7:i,i).getFullYear())!==u.getFullYear())&&-1<(t=a.indexOf("yyyy"))&&(e=Number(r.substring(t,t+4)))&&!isNaN(e)&&(r=r.replace(""+e,""+l))):u=null,K.datePanelValue=u,K.datePanelLabel=r},Me=()=>{var e=x.value,t=K["inputValue"];e&&(i(t),K.inputValue=I.multiple?Z.value:K.datePanelLabel)},Ce=()=>{var e=x.value;Se(I.modelValue),e&&Me()},Ae=()=>{K.inputValue=I.multiple?Z.value:K.datePanelLabel},f=e=>{var t=y.value,a=_xeUtils.default.getYearWeek(e,t),t=_xeUtils.default.getWhatWeek(e,0,t,t),a=_xeUtils.default.getWhatMonth(1===a?_xeUtils.default.getWhatDay(t,6):e,0,"first");_xeUtils.default.isEqual(a,K.selectMonth)||(K.selectMonth=a)},v=(t,e)=>{var{modelValue:a,multiple:l}=I;const i=K["datetimePanelValue"];var u=o.value;const r=p.value;var s=y.value;"week"===I.type?(d=_xeUtils.default.toNumber(I.selectDay),t=_xeUtils.default.getWhatWeek(t,0,d,s)):u&&i&&(t.setHours(i.getHours()),t.setMinutes(i.getMinutes()),t.setSeconds(i.getSeconds()));const n=_xeUtils.default.toDateString(t,r,{firstDay:s});if(f(t),l){var d=F.value;if(u){s=e?[]:[...H.value];const v=[];l=_xeUtils.default.findIndexOf(s,e=>_xeUtils.default.isDateSame(t,e,"yyyyMMdd"));if(-1===l){if(d)return;s.push(t)}else s.splice(l,1);s.forEach(e=>{e&&(i&&(e.setHours(i.getHours()),e.setMinutes(i.getMinutes()),e.setSeconds(i.getSeconds())),v.push(e))}),_(v.map(e=>_xeUtils.default.toDateString(e,r)).join(","),{type:"update"})}else{u=e?[]:Q.value;u.some(e=>_xeUtils.default.isEqual(e,n))?_(u.filter(e=>!_xeUtils.default.isEqual(e,n)).join(","),{type:"update"}):d||_(u.concat([n]).join(","),{type:"update"})}}else _xeUtils.default.isEqual(a,n)||_(n,{type:"update"})},E=()=>{var a=I["type"],{inputValue:l,datetimePanelValue:i}=K,u=n.value;if(!ke.value)if(l){let t=d(l,u);if(_xeUtils.default.isValidDate(t))if("time"===a)l!==(t=_xeUtils.default.toDateString(t,u))&&_(t,{type:"check"}),K.inputValue=t;else{let e=!1;var r=y.value;"datetime"===a?(a=B.value,l===_xeUtils.default.toDateString(a,u)&&l===_xeUtils.default.toDateString(t,u)||(e=!0,i&&(i.setHours(t.getHours()),i.setMinutes(t.getMinutes()),i.setSeconds(t.getSeconds())))):e=!0,K.inputValue=_xeUtils.default.toDateString(t,u,{firstDay:r}),e&&v(t)}else Ae()}else _("",{type:"check"})},Ye=e=>{var t=K["inputValue"];De.value||_(t,e),E(),K.visiblePanel||(K.isActivated=!1),m("blur",{value:t},e),a&&l&&a.triggerItemEvent(e,l.itemConfig.field,t)},Le=e=>{t(e)},qe=e=>{t(e)},Oe=(e,t)=>{var a=y.value,l=_xeUtils.default.getYearWeek(e,a),a=_xeUtils.default.getWhatWeek(e,0,a,a),l=_xeUtils.default.getWhatMonth(1===l?_xeUtils.default.getWhatDay(a,6):e,t,"first");K.selectMonth=l},Ie=()=>{var e=I["type"],t=y.value;let a=new Date;switch(e){case"week":a=_xeUtils.default.getWhatWeek(a,0,t);break;case"datetime":a=new Date,K.datetimePanelValue=new Date;break;default:a=_xeUtils.default.getWhatDay(Date.now(),0,"first")}K.currentDate=a,Oe(a,0)},Ke=()=>{K.datePanelType="year"},He=()=>{let e=K["datePanelType"];e="month"===e||"quarter"===e?"year":"month",K.datePanelType=e},Fe=t=>{var a=I["type"],{datePanelType:l,selectMonth:i,inputValue:u}=K,r=c["yearSize"];if(!X.value){let e;e="year"===a?_xeUtils.default.getWhatYear(i,-r,"first"):"month"===a||"quarter"===a?"year"===l?_xeUtils.default.getWhatYear(i,-r,"first"):_xeUtils.default.getWhatYear(i,-1,"first"):"year"===l?_xeUtils.default.getWhatYear(i,-r,"first"):"month"===l?_xeUtils.default.getWhatYear(i,-1,"first"):_xeUtils.default.getWhatMonth(i,-1,"first"),K.selectMonth=e,m("date-prev",{viewType:l,viewDate:e,value:u,type:a},t)}},Be=e=>{Ie(),v(K.currentDate,!0),I.multiple||S(),m("date-today",{type:I.type},e)},Re=t=>{var a=I["type"],{datePanelType:l,selectMonth:i,inputValue:u}=K,r=c["yearSize"];if(!ee.value){let e;e="year"===a?_xeUtils.default.getWhatYear(i,r,"first"):"month"===a||"quarter"===a?"year"===l?_xeUtils.default.getWhatYear(i,r,"first"):_xeUtils.default.getWhatYear(i,1,"first"):"year"===l?_xeUtils.default.getWhatYear(i,r,"first"):"month"===l?_xeUtils.default.getWhatYear(i,1,"first"):_xeUtils.default.getWhatMonth(i,1,"first"),K.selectMonth=e,m("date-next",{viewType:l,value:u,type:a},t)}},R=e=>{var t=I["disabledMethod"],a=K["datePanelType"],l=q.value,i=O.value,e=e["date"];return!!(l&&l.getTime()>e.getTime())||!!(i&&i.getTime()<e.getTime())||!!t&&t({type:a,viewType:a,date:e,$datePicker:s})},Ge=e=>{var{type:t,multiple:a}=I,l=K["datePanelType"];"month"===t?"year"===l?(K.datePanelType="month",f(e)):(v(e),a||S()):"year"===t?(v(e),a||S()):"quarter"===t?"year"===l?(K.datePanelType="quarter",f(e)):(v(e),a||S()):"month"===l?(K.datePanelType="week"===t?t:"day",f(e)):"year"===l?(K.datePanelType="month",f(e)):(v(e),"datetime"===t||a||S())},G=e=>{R(e)||Ge(e.date)},ze=t=>{R({date:t})||(pe.value.some(e=>_xeUtils.default.isDateSame(e.date,t,"yyyyMMdd"))||f(t),i(t))},je=t=>{R({date:t})||(le.value.some(e=>_xeUtils.default.isDateSame(e.date,t,"yyyy"))||f(t),i(t))},$e=t=>{R({date:t})||(de.value.some(e=>_xeUtils.default.isDateSame(e.date,t,"yyyyq"))||f(t),i(t))},Qe=t=>{R({date:t})||(oe.value.some(e=>_xeUtils.default.isDateSame(e.date,t,"yyyyMM"))||f(t),i(t))},z=e=>{var t;R(e)||(t=K["datePanelType"],("month"===t?Qe:"quarter"===t?$e:"year"===t?je:ze)(e.date))},Ze=e=>{var t;e&&(t=e.offsetHeight,e.parentNode.scrollTop=e.offsetTop-4*t)},Je=e=>{var t=K["datetimePanelValue"];K.datetimePanelValue=t?new Date(t.getTime()):new Date,Ze(e.currentTarget)},Xe=()=>{var e=I["multiple"];const t=K["datetimePanelValue"];var a=B.value,l=o.value;if(l){const i=p.value;if(e){e=Q.value;if(l){l=[...H.value];const u=[];l.forEach(e=>{e&&(t&&(e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds())),u.push(e))}),_(u.map(e=>_xeUtils.default.toDateString(e,i)).join(","),{type:"update"})}else _(e.join(","),{type:"update"})}else v(a||K.currentDate)}S()},et=()=>{var e=I["type"],t=o.value,a=B.value;-1<["year","quarter","month","week"].indexOf(e)?K.datePanelType=e:K.datePanelType="day",K.currentDate=_xeUtils.default.getWhatDay(Date.now(),0,"first"),a?(Oe(a,0),i(a)):Ie(),t&&(K.datetimePanelValue=K.datePanelValue||_xeUtils.default.getWhatDay(Date.now(),0,"first"),(0,_vue.nextTick)(()=>{var e=C.value;_xeUtils.default.arrayEach(e.querySelectorAll("li.is--selected"),e=>{Ze(e)})}))},tt=()=>(0,_vue.nextTick)().then(()=>{var l=I["placement"],i=K["panelIndex"],u=U.value,r=M.value,e=Y.value;if(u&&r){var s=u.offsetHeight,n=u.offsetWidth,d=r.offsetHeight,r=r.offsetWidth,i={zIndex:i},{boundingTop:u,boundingLeft:v,visibleHeight:o,visibleWidth:c}=(0,_dom.getAbsolutePos)(u);let a="bottom";if(e){let e=v,t=u+s;"top"===l?(a="top",t=u-d):l||(t+d+5>o&&(a="top",t=u-d),t<5&&(a="bottom",t=u+s)),e+r+5>c&&(e-=e+r+5-c),e<5&&(e=5),Object.assign(i,{left:e+"px",top:t+"px",minWidth:n+"px"})}else"top"===l?(a="top",i.bottom=s+"px"):l||(i.top=s+"px",o<u+s+d&&5<u-s-d&&(a="top",i.top="",i.bottom=s+"px"));return K.panelStyle=i,K.panelPlacement=a,(0,_vue.nextTick)()}}),at=()=>{var e=K["visiblePanel"],t=P.value,a=x.value;return(t||e?(0,_vue.nextTick):(K.initialized||(K.initialized=!0),c.hpTimeout&&(clearTimeout(c.hpTimeout),c.hpTimeout=void 0),K.isActivated=!0,K.isAniVisible=!0,a&&et(),setTimeout(()=>{K.visiblePanel=!0},10),K.panelIndex<(0,_utils.getLastZIndex)()&&(K.panelIndex=(0,_utils.nextZIndex)()),tt))()},w=e=>{D.value||(e.preventDefault(),at())},lt=e=>{t(e)},it=({option:e,$event:t})=>{var a=Pe.value,l=a["autoClose"],a=e.clickMethod||a.clickMethod,e={$datePicker:s,option:e};a&&a(e),l&&S(),m("shortcut-click",e,t)},ut=e=>{var{visiblePanel:t,isActivated:a}=K,l=x.value,i=b.value,u=r.value;!P.value&&a&&(K.isActivated=(0,_dom.getEventTargetNode)(e,i).flag||(0,_dom.getEventTargetNode)(e,u).flag,K.isActivated||(l?t&&(S(),E()):E()))},rt=t=>{var a=I["clearable"],l=K["visiblePanel"],i=x.value;if(!P.value){var u=_ui.globalEvents.hasKey(t,_ui.GLOBAL_EVENT_KEYS.TAB),r=_ui.globalEvents.hasKey(t,_ui.GLOBAL_EVENT_KEYS.DELETE),s=_ui.globalEvents.hasKey(t,_ui.GLOBAL_EVENT_KEYS.ESCAPE),n=_ui.globalEvents.hasKey(t,_ui.GLOBAL_EVENT_KEYS.ENTER),d=_ui.globalEvents.hasKey(t,_ui.GLOBAL_EVENT_KEYS.ARROW_LEFT),v=_ui.globalEvents.hasKey(t,_ui.GLOBAL_EVENT_KEYS.ARROW_UP),o=_ui.globalEvents.hasKey(t,_ui.GLOBAL_EVENT_KEYS.ARROW_RIGHT),c=_ui.globalEvents.hasKey(t,_ui.GLOBAL_EVENT_KEYS.ARROW_DOWN),p=_ui.globalEvents.hasKey(t,_ui.GLOBAL_EVENT_KEYS.PAGE_UP),_=_ui.globalEvents.hasKey(t,_ui.GLOBAL_EVENT_KEYS.PAGE_DOWN),d=d||v||o||c;let e=K.isActivated;if(u)e&&E(),e=!1,K.isActivated=e;else if(d){if(i&&e)if(l){var o=t,{isActivated:d,datePanelValue:f,datePanelType:m}=K;if(d){o.preventDefault();var d=_ui.globalEvents.hasKey(o,_ui.GLOBAL_EVENT_KEYS.ARROW_LEFT),h=_ui.globalEvents.hasKey(o,_ui.GLOBAL_EVENT_KEYS.ARROW_UP),g=_ui.globalEvents.hasKey(o,_ui.GLOBAL_EVENT_KEYS.ARROW_RIGHT),o=_ui.globalEvents.hasKey(o,_ui.GLOBAL_EVENT_KEYS.ARROW_DOWN);if("year"===m){let e=_xeUtils.default.getWhatYear(f||Date.now(),0,"first");d?e=_xeUtils.default.getWhatYear(e,-1):h?e=_xeUtils.default.getWhatYear(e,-4):g?e=_xeUtils.default.getWhatYear(e,1):o&&(e=_xeUtils.default.getWhatYear(e,4)),je(e)}else if("quarter"===m){let e=_xeUtils.default.getWhatQuarter(f||Date.now(),0,"first");d?e=_xeUtils.default.getWhatQuarter(e,-1):h?e=_xeUtils.default.getWhatQuarter(e,-2):g?e=_xeUtils.default.getWhatQuarter(e,1):o&&(e=_xeUtils.default.getWhatQuarter(e,2)),$e(e)}else if("month"===m){let e=_xeUtils.default.getWhatMonth(f||Date.now(),0,"first");d?e=_xeUtils.default.getWhatMonth(e,-1):h?e=_xeUtils.default.getWhatMonth(e,-4):g?e=_xeUtils.default.getWhatMonth(e,1):o&&(e=_xeUtils.default.getWhatMonth(e,4)),Qe(e)}else if("week"===m){let e=f||_xeUtils.default.getWhatDay(Date.now(),0,"first");m=y.value;h?e=_xeUtils.default.getWhatWeek(e,-1,m):o&&(e=_xeUtils.default.getWhatWeek(e,1,m)),ze(e)}else{let e=f||_xeUtils.default.getWhatDay(Date.now(),0,"first");d?e=_xeUtils.default.getWhatDay(e,-1):h?e=_xeUtils.default.getWhatWeek(e,-1,e.getDay()):g?e=_xeUtils.default.getWhatDay(e,1):o&&(e=_xeUtils.default.getWhatWeek(e,1,e.getDay())),ze(e)}}}else(v||c)&&w(t)}else n?i&&(l?K.datePanelValue?Ge(K.datePanelValue):S():e&&w(t)):(p||_)&&i&&e&&(m=t,f=K.isActivated)&&(f=_ui.globalEvents.hasKey(m,_ui.GLOBAL_EVENT_KEYS.PAGE_UP),m.preventDefault(),(f?Fe:Re)(m));u||s?l&&S():r&&a&&e&&We(t,null)}},st=e=>{var t=K["visiblePanel"];P.value||t&&(t=r.value,((0,_dom.getEventTargetNode)(e,t).flag?tt:(S(),E))())},nt=()=>{var{isActivated:e,visiblePanel:t}=K;t?(S(),E()):e&&E()},m=(e,t,a)=>{h(e,(0,_ui.createEvent)(a,{$datePicker:s},t))},j=(e={dispatchEvent:m,focus(){var e=U.value;return K.isActivated=!0,e.focus(),(0,_vue.nextTick)()},blur(){return U.value.blur(),(K.isActivated=!1,_vue.nextTick)()},select(){return U.value.select(),(K.isActivated=!1,_vue.nextTick)()},showPanel:at,hidePanel:S,updatePlacement:tt},Object.assign(s,e),(e,t)=>{var a,l=I["festivalMethod"];return l?(a=K["datePanelType"],e=(a=(l=l({type:a,viewType:a,date:e.date,$datePicker:s}))?_xeUtils.default.isString(l)?{label:l}:l:{}).extra?_xeUtils.default.isString(a.extra)?{label:a.extra}:a.extra:null,l=[(0,_vue.h)("span",{class:["vxe-date-picker--date-label",{"is-notice":a.notice}]},e&&e.label?[(0,_vue.h)("span",""+t),(0,_vue.h)("span",{class:["vxe-date-picker--date-label--extra",e.important?"is-important":"",e.className],style:e.style},_xeUtils.default.toValueString(e.label))]:""+t)],(e=a.label)&&(e=_xeUtils.default.toValueString(e).split(","),l.push((0,_vue.h)("span",{class:["vxe-date-picker--date-festival",a.important?"is-important":"",a.className],style:a.style},[1<e.length?(0,_vue.h)("span",{class:["vxe-date-picker--date-festival--overlap","overlap--"+e.length]},e.map(e=>(0,_vue.h)("span",e.substring(0,3)))):(0,_vue.h)("span",{class:"vxe-date-picker--date-festival--label"},e[0].substring(0,3))]))),l):t}),dt=()=>{var e=K["datePanelType"];switch(e){case"week":{const l=I["multiple"],{datePanelType:i,datePanelValue:u}=K,r=B.value;var t=se.value,a=fe.value;const s=H.value,n=F.value,d="yyyyMMdd";return[(0,_vue.h)("table",{class:`vxe-date-picker--date-${i}-view`,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",t.map(e=>(0,_vue.h)("th",e.label)))]),(0,_vue.h)("tbody",a.map(e=>{const t=l?e.some(t=>s.some(e=>_xeUtils.default.isDateSame(e,t.date,d))):e.some(e=>_xeUtils.default.isDateSame(r,e.date,d)),a=e.some(e=>_xeUtils.default.isDateSame(u,e.date,d));return(0,_vue.h)("tr",e.map(e=>(0,_vue.h)("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--now":e.isNow,"is--next":e.isNext,"is--disabled":R(e),"is--selected":t,"is--over":n&&!t,"is--hover":!n&&a},onClick:()=>G(e),onMouseenter:()=>z(e)},j(e,e.label))))}))])];return}case"month":{const v=I["multiple"],{datePanelType:o,datePanelValue:c}=K,p=B.value;t=ce.value;const _=H.value,f=F.value,m="yyyyMM";return[(0,_vue.h)("table",{class:`vxe-date-picker--date-${o}-view`,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",t.map(e=>(0,_vue.h)("tr",e.map(t=>{var e=v?_.some(e=>_xeUtils.default.isDateSame(e,t.date,m)):_xeUtils.default.isDateSame(p,t.date,m);return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":R(t),"is--selected":e,"is--over":f&&!e,"is--hover":!f&&_xeUtils.default.isDateSame(c,t.date,m)},onClick:()=>G(t),onMouseenter:()=>z(t)},j(t,(0,_ui.getI18n)("vxe.input.date.months.m"+t.month)))}))))])];return}case"quarter":{const h=I["multiple"],{datePanelType:g,datePanelValue:x}=K,y=B.value;a=ve.value;const k=H.value,b=F.value,U="yyyyq";return[(0,_vue.h)("table",{class:`vxe-date-picker--date-${g}-view`,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",a.map(e=>(0,_vue.h)("tr",e.map(t=>{var e=h?k.some(e=>_xeUtils.default.isDateSame(e,t.date,U)):_xeUtils.default.isDateSame(y,t.date,U);return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":R(t),"is--selected":e,"is--over":b&&!e,"is--hover":!b&&_xeUtils.default.isDateSame(x,t.date,U)},onClick:()=>G(t),onMouseenter:()=>z(t)},j(t,(0,_ui.getI18n)("vxe.input.date.quarters.q"+t.quarter)))}))))])];return}case"year":{const D=I["multiple"],{datePanelType:P,datePanelValue:S}=K,E=B.value;var Y=ne.value;const w=H.value,V=F.value,T="yyyy";return[(0,_vue.h)("table",{class:`vxe-date-picker--date-${P}-view`,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",Y.map(e=>(0,_vue.h)("tr",e.map(t=>{var e=D?w.some(e=>_xeUtils.default.isDateSame(e,t.date,T)):_xeUtils.default.isDateSame(E,t.date,T);return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":R(t),"is--selected":e,"is--over":V&&!e,"is--hover":!V&&_xeUtils.default.isDateSame(S,t.date,T)},onClick:()=>G(t),onMouseenter:()=>z(t)},j(t,t.year))}))))])];return}}{const W=I["multiple"],{datePanelType:N,datePanelValue:M}=K,q=B.value;var e=re.value,L=_e.value;const O=H.value,C=F.value,A="yyyyMMdd";return[(0,_vue.h)("table",{class:`vxe-date-picker--date-${N}-view`,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",e.map(e=>(0,_vue.h)("th",e.label)))]),(0,_vue.h)("tbody",L.map(e=>(0,_vue.h)("tr",e.map(t=>{var e=W?O.some(e=>_xeUtils.default.isDateSame(e,t.date,A)):_xeUtils.default.isDateSame(q,t.date,A);return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":R(t),"is--selected":e,"is--over":C&&!e,"is--hover":!C&&_xeUtils.default.isDateSame(M,t.date,A)},onClick:()=>G(t),onMouseenter:()=>z(t)},j(t,t.label))}))))])]}},vt=()=>{var e=I["multiple"],t=K["datePanelType"],a=X.value,l=ee.value,i=ie.value,u=$.value;return[(0,_vue.h)("div",{class:"vxe-date-picker--date-picker-header"},[(0,_vue.h)("div",{class:"vxe-date-picker--date-picker-type-wrapper"},["year"===t?(0,_vue.h)("span",{class:"vxe-date-picker--date-picker-label"},i.y):(0,_vue.h)("span",{class:"vxe-date-picker--date-picker-btns"},[(0,_vue.h)("span",{class:"vxe-date-picker--date-picker-btn",onClick:Ke},i.y),i.m?(0,_vue.h)("span",{class:"vxe-date-picker--date-picker-btn",onClick:He},i.m):(0,_ui.renderEmptyElement)(s)])]),(0,_vue.h)("div",{class:"vxe-date-picker--date-picker-btn-wrapper"},[(0,_vue.h)("span",{class:["vxe-date-picker--date-picker-btn vxe-date-picker--date-picker-prev-btn",{"is--disabled":a}],onClick:Fe},[(0,_vue.h)("i",{class:"vxe-icon-caret-left"})]),(0,_vue.h)("span",{class:"vxe-date-picker--date-picker-btn vxe-date-picker--date-picker-current-btn",onClick:Be},[(0,_vue.h)("i",{class:"vxe-icon-dot"})]),(0,_vue.h)("span",{class:["vxe-date-picker--date-picker-btn vxe-date-picker--date-picker-next-btn",{"is--disabled":l}],onClick:Re},[(0,_vue.h)("i",{class:"vxe-icon-caret-right"})]),e&&u?(0,_vue.h)("span",{class:"vxe-date-picker--date-picker-btn vxe-date-picker--date-picker-confirm-btn"},[(0,_vue.h)("button",{class:"vxe-date-picker--date-picker-confirm",type:"button",onClick:Xe},(0,_ui.getI18n)("vxe.button.confirm"))]):null])]),(0,_vue.h)("div",{class:"vxe-date-picker--date-picker-body"},dt())]},ot=()=>{const t=K["datetimePanelValue"];var e=te.value,a=me.value,l=ge.value,i=he.value,u=xe.value,r=ye.value;return[(0,_vue.h)("div",{class:"vxe-date-picker--time-picker-header"},[l?(0,_vue.h)("div",{class:"vxe-date-picker--time-picker-title"},e):(0,_vue.createCommentVNode)(),(0,_vue.h)("div",{class:"vxe-date-picker--time-picker-btn"},[(0,_vue.h)("button",{class:"vxe-date-picker--time-picker-confirm",type:"button",onClick:Xe},(0,_ui.getI18n)("vxe.button.confirm"))])]),(0,_vue.h)("div",{ref:C,class:"vxe-date-picker--time-picker-body"},[(0,_vue.h)("ul",{class:"vxe-date-picker--time-picker-hour-list"},a.map((l,e)=>(0,_vue.h)("li",{key:e,class:{"is--selected":t&&t.getHours()===l.value},onClick:e=>{return e=e,t=l,(a=K.datetimePanelValue)&&a.setHours(t.value),void Je(e);var t,a}},l.label))),l?(0,_vue.h)("ul",{class:"vxe-date-picker--time-picker-minute-list"},i.map((l,e)=>(0,_vue.h)("li",{key:e,class:{"is--selected":t&&t.getMinutes()===l.value},onClick:e=>{return e=e,t=l,(a=K.datetimePanelValue)&&a.setMinutes(t.value),void Je(e);var t,a}},l.label))):(0,_vue.createCommentVNode)(),l&&u?(0,_vue.h)("ul",{class:"vxe-date-picker--time-picker-second-list"},r.map((l,e)=>(0,_vue.h)("li",{key:e,class:{"is--selected":t&&t.getSeconds()===l.value},onClick:e=>{return e=e,t=l,(a=K.datetimePanelValue)&&a.setSeconds(t.value),void Je(e);var t,a}},l.label))):(0,_vue.createCommentVNode)()])]},V=(e,t)=>{var a=Pe.value,{options:l,position:i,align:u,mode:r}=a;return(0,_utils.isEnableConf)(a)&&l&&l.length&&(i||"left")===e?(0,_vue.h)("div",{class:`vxe-date-picker--panel-${e}-wrapper`},[(0,_vue.h)(_buttonGroup.default,{options:l,mode:r,align:u,vertical:t,onClick:it})]):(0,_ui.renderEmptyElement)(s)},ct=()=>{var e=I["type"];return"datetime"===e?(0,_vue.h)("div",{key:e,ref:r,class:"vxe-date-picker--panel-datetime-layout-wrapper"},[(0,_vue.h)("div",{class:"vxe-date-picker--panel-datetime-left-wrapper"},vt()),(0,_vue.h)("div",{class:"vxe-date-picker--panel-datetime-right-wrapper"},ot())]):"time"===e?(0,_vue.h)("div",{key:e,ref:r,class:"vxe-date-picker--panel-wrapper"},ot()):(0,_vue.h)("div",{key:e||"default",ref:r,class:"vxe-date-picker--panel-wrapper"},vt())},pt=()=>(0,_vue.h)("div",{class:"vxe-date-picker--control-icon",onClick:w},[(0,_vue.h)("i",{class:["vxe-date-picker--date-picker-icon",(0,_ui.getIcon)().DATE_PICKER_DATE]})]);return(0,_vue.watch)(()=>I.modelValue,e=>{Se(e),Me()}),(0,_vue.watch)(()=>I.type,()=>{Object.assign(K,{inputValue:"",datetimePanelValue:null,datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}),Ce()}),(0,_vue.watch)(n,()=>{x.value&&(i(K.datePanelValue),K.inputValue=I.multiple?Z.value:K.datePanelLabel)}),(0,_vue.nextTick)(()=>{_ui.globalEvents.on(s,"mousewheel",st),_ui.globalEvents.on(s,"mousedown",ut),_ui.globalEvents.on(s,"keydown",rt),_ui.globalEvents.on(s,"blur",nt)}),(0,_vue.onUnmounted)(()=>{_ui.globalEvents.off(s,"mousewheel"),_ui.globalEvents.off(s,"mousedown"),_ui.globalEvents.off(s,"keydown"),_ui.globalEvents.off(s,"blur")}),Ce(),s.renderVN=()=>{var e,t,a,l,i,u,r,s,n,d,{className:v,type:o,align:c,name:p,autocomplete:_,autoComplete:f}=I,{inputValue:m,visiblePanel:h,isActivated:g}=K,x=N.value,y=P.value;return D.value?(0,_vue.h)("div",{ref:b,class:["vxe-date-picker--readonly","type--"+o,v]},m):(e=ke.value,t=be.value,a=Ue.value,l=L.value,u=I.prefixIcon,i=(i=k.prefix)||u?(0,_vue.h)("div",{class:"vxe-date-picker--prefix",onClick:Te},[(0,_vue.h)("div",{class:"vxe-date-picker--prefix-icon"},i?(0,_vn.getSlotVNs)(i({})):[(0,_vue.h)("i",{class:u})])]):null,u=I.suffixIcon,r=K.inputValue,s=k.suffix,n=P.value,d=L.value,n=(0,_vue.h)("div",{class:["vxe-date-picker--suffix",{"is--clear":d&&!n&&!(""===r||_xeUtils.default.eqNull(r))}]},[d?(0,_vue.h)("div",{class:"vxe-date-picker--clear-icon",onClick:We},[(0,_vue.h)("i",{class:(0,_ui.getIcon)().INPUT_CLEAR})]):(0,_vue.createCommentVNode)(),pt(),s||u?(0,_vue.h)("div",{class:"vxe-date-picker--suffix-icon",onClick:Ne},s?(0,_vn.getSlotVNs)(s({})):[(0,_vue.h)("i",{class:u})]):(0,_vue.createCommentVNode)()]),(0,_vue.h)("div",{ref:b,class:["vxe-date-picker","type--"+o,v,{["size--"+x]:x,["is--"+c]:c,"is--prefix":!!i,"is--suffix":!!n,"is--visible":h,"is--disabled":y,"is--active":g,"show--clear":l&&!y&&!(""===m||_xeUtils.default.eqNull(m))}],spellcheck:!1},[i||(0,_vue.createCommentVNode)(),(0,_vue.h)("div",{class:"vxe-date-picker--wrapper"},[(0,_vue.h)("input",{ref:U,class:"vxe-date-picker--inner",value:m,name:p,type:t,placeholder:a,readonly:e,disabled:y,autocomplete:f||_,onKeydown:Le,onKeyup:qe,onClick:lt,onInput:Ee,onChange:we,onFocus:Ve,onBlur:Ye})]),n||(0,_vue.createCommentVNode)(),(()=>{var e=I["type"],{initialized:t,isAniVisible:a,visiblePanel:l,panelPlacement:i,panelStyle:u}=K,r=N.value,s=Y.value,{options:n,position:d}=Pe.value,v=k.header,o=k.footer,c=k.top,p=k.bottom,_=k.left,f=k.right,n=n&&n.length;return(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!s||!t},[(0,_vue.h)("div",{ref:M,class:["vxe-table--ignore-clear vxe-date-picker--panel","type--"+e,{["size--"+r]:r,"is--transfer":s,"ani--leave":a,"ani--enter":l,"show--top":!!(c||v||n&&("top"===d||"header"===d)),"show--bottom":!!(p||o||n&&("bottom"===d||"footer"===d)),"show--left":!!(_||n&&"left"===d),"show--right":!!(f||n&&"right"===d)}],placement:i,style:u},t&&(l||a)?[(0,_vue.h)("div",{class:"vxe-date-picker--panel-layout-wrapper"},[c?(0,_vue.h)("div",{class:"vxe-date-picker--panel-top-wrapper"},c({})):V("top"),(0,_vue.h)("div",{class:"vxe-date-picker--panel-body-layout-wrapper"},[_?(0,_vue.h)("div",{class:"vxe-date-picker--panel-left-wrapper"},_({})):V("left",!0),(0,_vue.h)("div",{class:"vxe-date-picker--panel-body-content-wrapper"},[v?(0,_vue.h)("div",{class:"vxe-date-picker--panel-header-wrapper"},v({})):V("header"),(0,_vue.h)("div",{class:"vxe-date-picker--panel-body-wrapper"},[ct()]),o?(0,_vue.h)("div",{class:"vxe-date-picker--panel-footer-wrapper"},o({})):V("footer")]),f?(0,_vue.h)("div",{class:"vxe-date-picker--panel-right-wrapper"},f({})):V("right",!0)]),p?(0,_vue.h)("div",{class:"vxe-date-picker--panel-bottom-wrapper"},p({})):V("bottom")])]:[])])})()]))},s},render(){return this.renderVN()}});